#!/bin/sh

# ------------------------------------------------------------------
# SETTINGS
# ------------------------------------------------------------------
[ -z "$DOTFILES_REPO" ] \
    && CONFIG_REPO="$HOME/Dotfiles" \
	|| CONFIG_REPO="$DOTFILES_REPO"

# ------------------------------------------------------------------
# FUNCTIONS
# ------------------------------------------------------------------
install_subfolder(){
	[ -z "$1" ] && return
	if [ -z "$2" ]; then
			if [ -f "$XDG_DATA_HOME/conf-pc-name" ]; then
					machine="$(cat $XDG_DATA_HOME/conf-pc-name)"
					echo "using $XDG_DATA_HOME/conf-pc-name for machine name"
			else
					machine="$(cat /etc/hostname)"
					echo "using /etc/hostname for machine name"
			fi
	else
			machine="$2"
			echo "using provided argument for machine name"
	fi
	! [ -d "$1" ] \
        && echo "$1 is not a directory" && return
	! [ -x "$1/install" ] \
        && echo "install script does not exist or is not executable, aborting." && return
    echo "Sourcing settings..."
    . "./$machine.prefs2"
    . "./colorschemes/$RECONF_COLORSCHEME.prefs2"
	prev_dir="$(pwd)"
	cd "$1"
	echo "Installing $1 for $machine..."
	./install "$machine"
	cd "$prev_dir"
}

# ------------------------------------------------------------------
# ACTUAL SCRIPT
# ------------------------------------------------------------------
cd "$CONFIG_REPO"
[ -z "$1" ] \
	&& echo "You need to provide a package to install" \
	|| install_subfolder "$1"

